From c3c1b63069548f51f2f9d6c78d57e5a44b116b26 Mon Sep 17 00:00:00 2001
From: Craig Disselkoen <cdisselk@cs.ucsd.edu>
Date: Thu, 3 Oct 2019 22:59:48 -0700
Subject: [PATCH] Bug 1586176 - EncryptUpdate should use maxout not block
 size. r=franziskus

[kunitsh@vmware.com: ported fix to v3.44]
Signed-off-by: Nitesh Kumar <kunitesh@vmware.com>
---
 nss/lib/softoken/pkcs11c.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/nss/lib/softoken/pkcs11c.c b/nss/lib/softoken/pkcs11c.c
index 003e2be..774bc06 100644
--- a/nss/lib/softoken/pkcs11c.c
+++ b/nss/lib/softoken/pkcs11c.c
@@ -1353,7 +1353,7 @@ NSC_EncryptUpdate(CK_SESSION_HANDLE hSession,
             }
             /* encrypt the current padded data */
             rv = (*context->update)(context->cipherInfo, pEncryptedPart,
-                                    &padoutlen, context->blockSize, context->padBuf,
+                                    &padoutlen, maxout, context->padBuf,
                                     context->blockSize);
             if (rv != SECSuccess) {
                 return sftk_MapCryptError(PORT_GetError());
-- 
2.34.1

