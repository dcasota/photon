diff -ru a/shell.c b/shell.c
--- a/shell.c	2021-04-19 18:56:36.000000000 +0000
+++ b/shell.c	2023-08-10 21:28:27.875415060 +0000
@@ -4156,9 +4156,11 @@
   rc = pBaseVfs->xOpen(pBaseVfs, zName, pBaseFile, flags, pOutFlags);
   if( rc==SQLITE_OK ){
     rc = pBaseFile->pMethods->xFileSize(pBaseFile, &sz);
+    if( rc ){
+     pBaseFile->pMethods->xClose(pBaseFile);
+    }
   }
   if( rc ){
-    pBaseFile->pMethods->xClose(pBaseFile);
     pFile->pMethods = 0;
     return rc;
   }
