From 59083b7a1e8798e5ebadf4812d04bab2db02c1e9 Mon Sep 17 00:00:00 2001
From: Guruswamy Basavaiah <bguruswamy@vmware.com>
Date: Sat, 26 Aug 2023 01:24:59 +0530
Subject: [PATCH] Fix a potential illegal memory access in the BFD library when
 parsing a corrupt DWARF file.

PR 29988
* dwarf2.c (read_indexed_address): Fix check for an out of range
offset.
---
 bfd/ChangeLog | 6 ++++++
 bfd/dwarf2.c  | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/bfd/ChangeLog b/bfd/ChangeLog
index e59ede55..7739b02c 100644
--- a/bfd/ChangeLog
+++ b/bfd/ChangeLog
@@ -1,3 +1,9 @@
+2023-01-11  Nick Clifton  <nickc@redhat.com>
+
+	PR 29988
+	* dwarf2.c (read_indexed_address): Fix check for an out of range
+	offset.
+
 2022-10-19  Nick Clifton  <nickc@redhat.com>
 
 	PR 29699
diff --git a/bfd/dwarf2.c b/bfd/dwarf2.c
index 25a80333..af945918 100644
--- a/bfd/dwarf2.c
+++ b/bfd/dwarf2.c
@@ -1375,7 +1375,7 @@ read_indexed_address (uint64_t idx, struct comp_unit *unit)
   offset += unit->dwarf_addr_offset;
   if (offset < unit->dwarf_addr_offset
       || offset > file->dwarf_addr_size
-      || file->dwarf_addr_size - offset < unit->offset_size)
+      || file->dwarf_addr_size - offset < unit->addr_size)
     return 0;
 
   info_ptr = file->dwarf_addr_buffer + offset;
-- 
2.25.1

