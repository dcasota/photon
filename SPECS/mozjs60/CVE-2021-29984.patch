From d05f240578e805116dfef848b167ea49e5163b93 Mon 26 Jul 2021 13:38:27 +0000
From: Jan de Mooij <jdemooij@mozilla.com>
Date: Mon, 26 Jul 2021 13:38:27 +0000
Subject: Bug 1720031 - Check for SetInitializedLength when reordering. r=iain a=pascalc

---

diff --color -Naur a/js/src/jit/InstructionReordering.cpp b/js/src/jit/InstructionReordering.cpp
--- a/js/src/jit/InstructionReordering.cpp	2019-09-01 18:39:18
+++ b/js/src/jit/InstructionReordering.cpp	2023-08-29 01:22:32
@@ -120,7 +120,9 @@
            riter != rtop; riter++) {
         MInstruction* prev = *riter;
         if (prev->isInterruptCheck()) break;
-
+        if (prev->isSetInitializedLength()) {
+          break;
+        }
         // The instruction can't be moved before any of its uses.
         bool isUse = false;
         for (size_t i = 0; i < ins->numOperands(); i++) {
